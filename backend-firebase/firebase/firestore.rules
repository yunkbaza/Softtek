rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Collections
    match /assessments/{docId} {
      allow create: if request.auth != null && request.resource.data.sessionId is string
                    && request.resource.data.type in ['anxiety','depression','burnout']
                    && request.resource.data.score is number
                    && request.resource.data.score >= 0 && request.resource.data.score <= 100;
      // Read limited to summaries via Cloud Functions; block direct read to manter anonimato/privacidade
      allow read: if false;
      allow update, delete: if false;
    }

    match /moods/{docId} {
      allow create: if request.auth != null && request.resource.data.sessionId is string
                    && request.resource.data.mood in ['muito_bem','bem','neutro','mal','muito_mal'];
      allow read: if false;
      allow update, delete: if false;
    }

    match /support_actions/{docId} {
      // Only admins via Cloud Functions (server-side) should write; block direct client ops
      allow read: if true;
      allow write: if false;
    }

    match /activity_logs/{docId} {
      // Logs only by server-side
      allow read, write: if false;
    }
  }
}